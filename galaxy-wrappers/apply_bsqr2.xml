<tool id="gatk4_ApplyBQSR2" name="GATK4 ApplyBQSR2" version="1.0.0">
    <description>- Apply base quality score recalibration</description>
    <requirements>
      <requirement type="package" version="4.2.6.1">gatk4</requirement>
    </requirements>

    <command>
        <![CDATA[
        ln -s '$FASTA' 'fasta.fa' &&
        samtools faidx fasta.fa --output fasta.fa.fai &&
        gatk CreateSequenceDictionary -R fasta.fa -O fasta.dict &&
        gatk ApplyBQSR -I "$INPUT" -O "$OUTPUT" -R 'fasta.fa' --bqsr-recal-file "$RECAL_TABLE"
        ]]>
    </command>
    <inputs>
      <param name="INPUT" type="data" format="bam" label="BAM file" />
      <param name="RECAL_TABLE" type="data" format="tabular" label="Covariates table" help="Recalibration file generated by BaseRecalibrator on the input BAM or CRAM file." />
      <param name="FASTA" type="data" format="fasta" label="Reference file"/>
      <param name="GENOME" type="select" label="Select reference genome" help="If your genome of interest is not listed, contact the Galaxy team" optional="True">
        <options from_data_table="fasta_indexes" />
      </param>
    </inputs>
    <outputs>
        <data name="OUTPUT" type="data" format="bam" label="Recalibrated BAM file"/>
    </outputs>

    <tests>
    </tests>

    <help>
      **What it does**

      Apply base quality score recalibration
      This tool performs the second pass in a two-stage process called Base Quality Score Recalibration (BQSR). Specifically, it recalibrates the base qualities of the input reads based on the recalibration table produced by the BaseRecalibrator tool, and outputs a recalibrated BAM or CRAM file.

      https://gatk.broadinstitute.org/hc/en-us/articles/360037055712-ApplyBQSR

    </help>

</tool>
